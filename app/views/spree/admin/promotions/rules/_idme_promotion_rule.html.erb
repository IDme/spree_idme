<div class="field alpha omega eight columns">
    <% # Parse out the current promotion rule from the params prefix %>
    <% rules_id = param_prefix.scan(/\d+/)[0].to_i %>
    <% rules = IdmePromotionRule.find rules_id %>
    <table>
      <tr>
        <% if @affinity_groups.nil? %>
          <META HTTP-EQUIV="refresh" CONTENT="1">
        <% else %>
          <%= hidden_field_tag "idme_promotion_rules_id", rules_id %>
          <% @affinity_groups.each do |group| %>
            <td>
              <%= check_box_tag "active_promotion_affinities[]", group.id.to_s,
                      rules.active_promotion_affinities.include?(group.id.to_s) %>
              <%= label_tag "active_promotion_affinities[]", group.name %>
            </td>
          <% end %>
        <% end %>

        <td>
          <% unless @settings.nil? %>
            <% if @settings.idme_client_id_string.nil? || @settings.idme_client_id_string.blank? %>
              <button name="api_keys">
                <span><a href="https://developer.id.me/" target="_blank" class="button">Obtain IDme API Keys</a></span>
              </button>
            <% end %>
          <% end %>
        </td>

        <td>
          <button name="settings">
            <span><%= link_to "ID.me Settings", admin_idme_settings_path %></span>
          </button>
        </td>
      </tr>
    </table>
</div>
